FROM python:3.11-slim

# Prevent Python from writing .pyc files and buffer stdout/stderr
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1

WORKDIR /app

# Install minimal build deps (only if needed) and clean apt cache
RUN apt-get update \
    && apt-get install -y --no-install-recommends build-essential \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements and install if present
COPY requirements.txt /app/requirements.txt
RUN if [ -f /app/requirements.txt ]; then \
      pip install --upgrade pip && \
      pip install -r /app/requirements.txt; \
    fi

# Copy application source
COPY . /app

# Default command â€” override when running the container.
# Set START_CMD via `docker run --env START_CMD="python main.py"` or change here.
ENV START_CMD="python main.py"

EXPOSE 8000

CMD ["sh", "-c", "$START_CMD"]